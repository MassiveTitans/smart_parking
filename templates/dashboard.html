
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parking Space Booking</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
  <link
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        rel="stylesheet"
    >
  <style>
     body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        }

    .menu {
            position: sticky;
            top: 0;
            background-color: #017A5B;
            padding: 7px 0;
            color: white;
            margin: 0 auto;
            overflow: hidden;
        }

        .menu a {
            float: left;
            color: white;
            text-align: center;
            padding: 7px 8px;
            text-decoration: none;
            font-size: 12px;
        }

        .menu-log {
            float: right;

        }

    .search_bar {
       
       display: flex;
       justify-content: flex-end; /* Center horizontally */
       align-items: center;     /* Center vertically */
       flex-grow: 1;            /* Allow it to grow and take available space */
       }
   .search_bar input[type="text"] {
       padding: 8px;
       border-color: #017A5B;
       border-radius: 5px;
       width: 200px; /* Adjust width as needed */
}
.body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        .marquee {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #ffcc00;
            color: #000;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            padding: 8px 0;
            overflow: hidden;
            z-index: 9999;
        }
        
        .marquee p {
            display: inline-block;
            white-space: nowrap;
            animation: scroll-left 20s linear infinite; /* Animatsiyani 20s qilib o'zgartirdik */
        }
        
        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        
        
            


         #map {
            height: 90vh;
        }

        #selection-panel {
            position: absolute;
            top: 130px;
            right: 10px; /* Move to the right */
            background-color: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .container {
            display: inline-flex;
            flex-wrap: wrap;
            position: fixed;
            max-width: 900px;
            top: 20px; /* Center it on the screen */
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0px 50px rgba(0, 0, 0, 0.1);
            gap: 20px;
        }
        label {
            font-size: 12px;
            font-weight: bold;
            display: block;
            margin-top: 0px;
            color: #333;
        }
        select {
            width: 100%;
            padding: 1px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            font-size: 12px;
            color: #333;
        }
        select:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 3px rgba(0, 123, 255, 0.5);
        }
        optgroup {
            font-weight: bold;
            color: #555;
        }
        option {
            padding: 5px;
        }

    .search_bar {
       
        display: flex;
        justify-content: flex-end; /* Center horizontally */
        align-items: center;     /* Center vertically */
        flex-grow: 1;            /* Allow it to grow and take available space */
        }
    .search_bar input[type="text"] {
        padding: 8px;
        border-color: #017A5B;
        border-radius: 5px;
        width: 200px; /* Adjust width as needed */
}


    .head1 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
    }

    .head_label {
        margin-left: 16px;
        color: #017A5B;
        font-size: 24px; /* Adjust font size for the label */
        font-weight: bold;

    }
    .area-label {
    font-size: 12px;
    color: black;
    background: white;
    border-radius: 4px;
    border: 1px solid black;
    padding: 4px;
    text-align: center;
}
    
    /* General Body Styling */
    /* Add animation to the available slots */
.available-slot {
  font-size: 1.2rem;
  font-weight: bold;
  color: #28a745; /* Green color */
  transition: transform 0.3s ease-out, opacity 0.3s ease-in-out;
}

.slot-changing {
  transform: scale(1.2);
  opacity: 0.7;
}
 

    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f4f7fc;
      color: #333;
    }

    /* Map container */
    #map {
      height: 90vh;
      width: 100%;
    }

    /* Popup Container */
    .popup-container {
      width: 250px; /* Reduced width */
      background-color: #fff;
      padding: 15px; /* Reduced padding */
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Popup Heading */
    .popup-container h4 {
      margin: 0;
      font-size: 1.2rem; /* Smaller heading font size */
      color: #4b6cb7;
    }

    /* Video Styling */
    .popup-container video {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 10px; /* Reduced margin */
      border: 1px solid #ddd;
    }

    /* Text and Inputs */
    .popup-container p {
      font-size: 0.9rem; /* Smaller text */
      color: #666;
    }

    .popup-container input,
    .popup-container select,
    .popup-container button {
      margin: 6px 0; /* Reduced margin */
      padding: 10px; /* Smaller padding */
      font-size: 0.9rem; /* Reduced font size */
      width: 100%;
      border: 2px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
    }

    /* Input and Button Focus */
    .popup-container input:focus,
    .popup-container select:focus,
    .popup-container button:focus {
      border-color: #4b6cb7;
      outline: none;
    }

    /* Button Styling */
    .popup-container button {
      background-color: #4b6cb7;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    /* Button Hover */
    .popup-container button:hover {
      background-color: #365f8f;
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      .popup-container {
        width: 100%;
        padding: 12px; /* Slightly smaller padding on mobile */
      }

      .popup-container h4 {
        font-size: 1rem; /* Smaller heading on mobile */
      }

      .popup-container video {
        width: 100%;
      }
    }

  
    
  </style>
</head>
<body>
    
    <!-- Header Section -->
    <header>
        <div class="head1" >
            <span class="head_logo" >
                <a href="{% url 'home' %}">
                    <img src="{% static  'images/parking-area.png' %}" width="45" height="50" alt="logo" />
                </a>

            </span>
    
            <span class="head_label">
                            Smart Parking
            </span>
    
            <!-- Search bar -->
            <div class="search_bar">
                <input type="text" placeholder="Hudud miqyosida izlash">
            </div>
        </div>
    </header>


    <!-- Menu Navigation Bar -->
    <nav class="menu">
        
        <a href="#home">Uskunalar paneli</a>
        <a href="#news">O'lchash</a>
        <a href="#notification">Qo'shimcha</a>
     
        <!-- menu-log class to float it to the right -->
        <div class="menu-log">
            <a href="{% url 'home' %}">Bosh menyuga qaytish</a>
        </div>

    </nav>


<div id="map"></div>

<script>
  // Initialize the Map
  var map = L.map('map').setView([41.652, 66.958], 6); // Set the center of the map

    // Add a tile layer from OpenStreetMap
    var baseMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    });

    var satelliteHybrid = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        attribution: 'Tiles © Esri &mdash; Source: Esri, Earthstar Geographics'
    });

    // Add the default base layer to the map
    baseMap.addTo(map);

    // Add layer control for switching between base layers
    var baseLayers = {
        "OpenStreet Map": baseMap,
        "Satellite Hybrid": satelliteHybrid
    };

    L.control.layers(baseLayers).addTo(map);


    fetch("{% static 'uzbekistan_regional.geojson' %}")
    .then(response => response.json())
    .then(data => {
        geojsonLayer = L.geoJSON(data); // Load GeoJSON data into the layer
        if (map.getZoom() < 9) {  // Only add the layer if zoom level is above 9
            geojsonLayer.addTo(map);
        }
    })
    .catch(error => {
        console.log("GeoJSON faylini yuklashda xatolik:", error);
    });

// Listen for the 'zoomend' event to track zoom changes
map.on('zoomend', function() {
    if (map.getZoom() < 9) { // Add the layer if zoom level is above 9
        if (!map.hasLayer(geojsonLayer)) {
            geojsonLayer.addTo(map);
        }
    } else { // Remove the layer if zoom level is 9 or below
        if (map.hasLayer(geojsonLayer)) {
            map.removeLayer(geojsonLayer);
        }
    }
});

  const parkingIcon = L.icon({
            iconUrl: "{% static 'images/1476779.png' %}", // Replace with your parking icon URL
            iconSize: [40, 40], // Size of the icon
            iconAnchor: [16, 32], // Anchor point of the icon (middle bottom)
            popupAnchor: [0, -32] // Popup anchor relative to the icon
        });


  // Parking Locations
  const parkingLocations = [
    { id: 1, name: "87PM+VV Ташкент, Узбекистан", coords: [41.33715672236005, 69.28464047269566] , icon: parkingIcon },
    { id: 2, name: "87PM+VV Ташкент, Узбекистан", coords: [51.51, -0.1] , icon: parkingIcon },
    { id: 3, name: "87PM+VV Ташкент, Узбекистан", coords: [51.49, -0.08]  , icon: parkingIcon}
  ];

  // Add Markers for Parking Locations
  parkingLocations.forEach((parking) => {
    const marker = L.marker(parking.coords , { icon: parkingIcon }).addTo(map);

    // Create Popup Content
    const popupContent = `
      <div class="popup-container">
        <h4>${parking.name}</h4>
        <video controls autoplay>
          <source src= "{% static 'images/parking.mp4' %}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <p>Available Slots: <strong>${Math.floor(Math.random() * 10 + 1)}</strong></p>
        <p>Status: <strong>Open</strong></p>
        <form id="bookingForm-${parking.id}">
          <input type="text" name="fullName" placeholder="Full Name" required />
          <input type="datetime-local" name="bookingTime" required />
          <input type="text" name="carNumber" placeholder="Car Number" required />
          <input type="tel" name="mobileNumber" placeholder="Mobile Number" required />
          <select name="payment" required>
            <option value="" disabled selected>Select Payment Method</option>
            <option value="card">Credit Card</option>
            <option value="cash">Cash</option>
          </select>
          <button type="submit">Book Now</button>
        </form>
      </div>
    `;

    // Bind Popup to Marker
    marker.bindPopup(popupContent);

    // Handle Booking Form Submission
    marker.on('popupopen', () => {
      const form = document.getElementById(`bookingForm-${parking.id}`);
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const bookingDetails = {
          fullName: formData.get('fullName'),
          bookingTime: formData.get('bookingTime'),
          carNumber: formData.get('carNumber'),
          mobileNumber: formData.get('mobileNumber'),
          payment: formData.get('payment')
        };
        alert(`Booking Confirmed:\n${JSON.stringify(bookingDetails, null, 2)}`);
        marker.closePopup();
      });
    });
  });
</script>

</body>
</html>
